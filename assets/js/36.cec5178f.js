(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{515:function(t,n,s){"use strict";s.r(n);var a=s(4),e=Object(a.a)({},(function(){var t=this,n=t.$createElement,s=t._self._c||n;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"nsmethodsignature-和-nsinvocation"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nsmethodsignature-和-nsinvocation"}},[t._v("#")]),t._v(" NSMethodSignature 和 NSInvocation")]),t._v(" "),s("h2",{attrs:{id:"常见的调用方法的两种方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常见的调用方法的两种方式"}},[t._v("#")]),t._v(" 常见的调用方法的两种方式")]),t._v(" "),s("ul",[s("li",[t._v("performSelector: withObject:"),s("br"),t._v(" "),s("strong",[t._v("优点：")]),t._v(" 可以调用运行时添加方法"),s("br"),t._v(" "),s("strong",[t._v("缺点：")]),t._v(" 在编译阶段不会做校验。只有在程序运行的时候，才会知道是否存在即将调用的方法，如果方法不存在，程序会崩溃。因此为了保证程序的健壮，在调用方法前应该使用 "),s("code",[t._v("- (BOOL)respondsToSelector:(SEL)aSelector")]),t._v("，检查方法是否实现。")]),t._v(" "),s("li",[t._v("直接调用方法"),s("br"),t._v(" "),s("strong",[t._v("优点：")]),t._v(" 在编译阶段就会教研方法是否存在，Xcode会有相应提示"),s("br"),t._v(" "),s("strong",[t._v("缺点：")]),t._v(" 局限性大，如果想调用某个方法，必须先实现这个方法，不如 "),s("code",[t._v("performSelector: withObject:")]),t._v(" 灵活。")])]),t._v(" "),s("h2",{attrs:{id:"使用-nsmethodsignature-和-nsinvocation-调用方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-nsmethodsignature-和-nsinvocation-调用方法"}},[t._v("#")]),t._v(" 使用 NSMethodSignature 和 NSInvocation 调用方法")]),t._v(" "),s("p",[t._v("使用 "),s("code",[t._v("NSMethodSignature")]),t._v(" 和 "),s("code",[t._v("NSInvocation")]),t._v(" 组合实现方法的调用。")]),t._v(" "),s("h3",{attrs:{id:"nsmethodsignature"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nsmethodsignature"}},[t._v("#")]),t._v(" NSMethodSignature")]),t._v(" "),s("p",[t._v("通过 "),s("code",[t._v("NSMethodSignature")]),t._v(" 可以获取方法的参数类型和返回值类型。常用方法有：")]),t._v(" "),s("div",{staticClass:"language-objc extra-class"},[s("pre",{pre:!0,attrs:{class:"language-objc"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//从实例中获取实例方法签名，或者从类中获取类方法签名")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("NSMethodSignature "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("instanceMethodSignatureForSelector"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("SEL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("aSelector\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//从一个类中获取实例方法签名")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("NSMethodSignature "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("methodSignatureForSelector"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("SEL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("aSelector\n")])])]),s("p",[t._v("可以通过下面的代码，更好的理解该怎么获取方法签名：")]),t._v(" "),s("div",{staticClass:"language-objc extra-class"},[s("pre",{pre:!0,attrs:{class:"language-objc"}},[s("code",[t._v("SEL initSEL "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("@selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("init"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nSEL allocSEL "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("@selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("alloc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 从NSString类中获取实例方法(init)的方法签名")]),t._v("\nNSMethodSignature "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("initSig "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSString instanceMethodSignatureForSelector"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("initSEL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 从test实例中获取实例方法(init)的方法签名")]),t._v("\ninitSig "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"test"')]),t._v(" methodSignatureForSelector"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("initSEL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 从NSString类中获取类方法签名")]),t._v("\nNSMethodSignature "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("allocSig "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSString methodSignatureForSelector"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("allocSEL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"nsinvocation"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nsinvocation"}},[t._v("#")]),t._v(" NSInvocation")]),t._v(" "),s("p",[s("code",[t._v("NSInvocation")]),t._v(" 可以说是 "),s("code",[t._v("performSelector: withObject:")]),t._v(" 的升级版，可以调用较为复杂的方法，进行参数、返回值的处理等;")]),t._v(" "),s("h3",{attrs:{id:"nsmethodsignature-和-nsinvocation-搭配的使用方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nsmethodsignature-和-nsinvocation-搭配的使用方法"}},[t._v("#")]),t._v(" NSMethodSignature 和 NSInvocation 搭配的使用方法")]),t._v(" "),s("div",{staticClass:"language-objc extra-class"},[s("pre",{pre:!0,attrs:{class:"language-objc"}},[s("code",[t._v("NSString "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("str "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"Test"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nstr "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("str stringByAppendingString"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@" AppendingString"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("NSLog")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"str: %@"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" str"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//需要调用的方法")]),t._v("\nSEL selector "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("@selector")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("stringByAppendingString"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取方法签名")]),t._v("\nNSMethodSignature "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("signature "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("str methodSignatureForSelector"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("selector"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//创建 NSInvocation 对象")]),t._v("\nNSInvocation "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("invocation "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("NSInvocation invocationWithMethodSignature"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("signature"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//设置消息接受对象")]),t._v("\ninvocation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" str"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//设置发送的消息")]),t._v("\ninvocation"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("selector "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" selector"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//建议通过signature.numberOfArgument获取参数个数")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//可以保证不多参，不少参")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//这边减2的原因是：")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//0位置的参数是 目标（self）")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//1位置的参数是 selector（_cmd）")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//所以2位置才是所需要的第一个参数")]),t._v("\nNSInteger paramCount "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" signature"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("numberOfArguments "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("NSLog")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"paramCount: %@"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("@")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("paramCount"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" paramCount"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//设置参数")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("invocation setArgument"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("str atIndex"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//执行 invocation")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("invocation invoke"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取返回值")]),t._v("\nid returnValue "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" nil"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("signature"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("methodReturnLength"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("invocation getReturnValue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("returnValue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("NSLog")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('@"returnValue: %@"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" returnValue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("hr"),t._v(" "),s("blockquote",[s("p",[t._v("Title: NSMethodSignature 和 NSInvocation")]),t._v(" "),s("p",[t._v("Date: 2018.03.10")]),t._v(" "),s("p",[t._v("Author: zhangpeng")]),t._v(" "),s("p",[t._v("Github: "),s("a",{attrs:{href:"https://github.com/fullstack-zhangpeng",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/fullstack-zhangpeng"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);n.default=e.exports}}]);